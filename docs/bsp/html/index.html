<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-Car CR7 Sample Software: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="renesas-site-logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">R-Car CR7 Sample Software
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">System description for CR7 sample software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> This software package provides a set of reference applications, drivers and middleware for the Cortex-R7 on Renesas R-Car SoCs.</p>
<p>This is reference software only. This means there is no guarantees for quality or performance, the software may contain bugs, and only "smoke" testing was done. The software was tested using R-Car Salvator-X/XS development boards with R-Car H3/M3/M3N/E3 SoCs. Additional support for R-Car Starter Kit with Kingfisher is also possible on request, as only very limited testing has been done for that environment.</p>
<div class="image">
<img src="Slide4.jpg" alt=""/>
</div>
<p>Our software features hypervisor-less, concurrent operating systems running in different core domains. The different operating systems communicate using VIRTIO over shared memory. To enable very quick boot timing, the environment boots from the Cortex-R7 which starts the Cortex-R7 RTOS followed by the Cortex-A53/57 Rich OS. <br  />
</p>
<p>An RTOS running on the Cortex-R7 has the advantage of executing time and safety critical applications. The Rich OS uses Renesas developed virtualized drivers that enable hardware requests that are managed by the RTOS. <br  />
</p>
<p>Our environment supports FreeRTOS and Trampoline (Open Source AutoSAR implementation) for the Cortex-R7 RTOS. <br  />
 On the Cortex-A53/57 we support Green Hills INTEGRITY, Linux, Android 10 and Android 11. <br  />
</p>
<h1><a class="anchor" id="autotoc_md9"></a>
System Overview</h1>
<div class="image">
<img src="Slide5.jpg" alt=""/>
</div>
<p>The system uses two system servers on the RTOS to realize shared hardware resources. Taurus and CIO (Common IO) servers.</p>
<p>The Taurus server listens for requests from the Rich OS using virtio over shared memory. For example, Para-DRM is our virtualized DRM driver. This driver sends request to Taurus for display functionality, such as requesting a layer, layer position, etc.</p>
<p>The CIO server listens to requests from both RTOS applications and from Taurus. The CIO manages the requests from these concurrent operating systems to handle hardware interactions. In most cases, RTOS applications should not directly use driver level APIs but instead communicate to the CIO server.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Cortex-R7 System Overview</h1>
<div class="image">
<img src="Slide6.jpg" alt=""/>
</div>
<p>The RTOS features many example applications, drivers and middleware.</p>
<p>The applications include 2D graphics, audio, camera input and many others. 2D graphics applications use our Window Manager and Draw2D APIs to interace with the DU (Display Unit), VSPDs (Video Signal Processors) and DHD (DaveHD 2D GPU)</p>
<p>The system uses an OSAL (Operating System Abstraction Layer) to allow easy integration with different operating systems.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Cortex-A5x System Overview</h1>
<div class="image">
<img src="Slide7.jpg" alt=""/>
</div>
<p>The Rich OS uses several virtualized drivers for hardware sharing functionality. It is important to highlight there are no changes required to applications or middleware, only the low-level kernel drivers.</p>
<p>The Rich OS must also contain an .elf file of the RTOS system in the Root FS. This is necessary to ensure the virtual communication queues are established correctly.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Debugging Concept</h1>
<div class="image">
<img src="Slide8.jpg" alt=""/>
</div>
<p>The two operating systems can debugged together or independently. Our team has great familiarity with the Lauterbach tools and scripts. We have some familiarity with Green Hills Probe.</p>
<p>There is no conflict with other tooling but note that we may not have any experience.</p>
<div class="image">
<img src="Slide9.jpg" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md13"></a>
Boot Process</h1>
<div class="image">
<img src="Slide11.jpg" alt=""/>
</div>
<p>Our original boot process was from the Cortex-A53/57, which then boots the Cortex-R7.</p>
<div class="image">
<img src="Slide12.jpg" alt=""/>
</div>
<p>Our fastboot boot process instead boots from the Cortex-R7. This enables much faster boot times.</p>
<p>The software is operational with either process.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
FFI (Freedom From Interference)</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Interrupt Handling Rich OS VS RTOS</h2>
<div class="image">
<img src="Slide13.jpg" alt=""/>
</div>
<p>For interrupt handling, Renesas R-Car SoCs feature two distinct GIC (Generic Interrupt Controller)</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Memory Overlap</h2>
<div class="image">
<img src="Slide14.jpg" alt=""/>
</div>
<p>The current implementation expects the Rich OS to take care not to corrupt or interfere with the memory of the RTOS, such as making the region "no-map" for Linux.</p>
<p>Renesas R-Car SoCs have dedicated IP for FFI memory protection called LifeC. More information about LifeC can be obtained from Renesas FuSa team.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
CR7 SDK Components</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
OSAL Concept</h2>
<div class="image">
<img src="Slide17.jpg" alt=""/>
</div>
<p>For the Cortex-R7, we provide two sample OSAL implementations. FreeRTOS and Trampoline (Open Source AutoSAR)</p>
<p>This layer enables porting to other operating systems easier. Applications, drivers and middleware should remain unchanged between different OSAL implementations.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Para-Virtualization</h2>
<div class="image">
<img src="Slide21.jpg" alt=""/>
</div>
<p>The Rich OS features several para-virtualized drivers to access hardware resources controlled by the RTOS.</p>
<p>These para-drivers use shared memory to communicate "requests" to the RTOS system. We ensure that the API of these drivers is identical to that of the original driver, so there will be no changes necessary to other parts of the system.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Inter-CPU Communications</h2>
<div class="image">
<img src="Slide22.jpg" alt=""/>
</div>
<p>Communication between RTOS and Rich OS is achieved by exchanging messages over shared memory using virtio protocol. The MFIS IP of R-Car SoCs is used to generate interrupts across core domains to signal a new message is available.</p>
<p>Rich OS can use rproc, for example, to read information about the communication queues from the RTOS .elf file.</p>
<p>The GPU does not use virtio-GPU. Instead, we have provided our own Para-DRM driver. This allows the Rich OS to have full access to the 3D GPU and simply share the framebuffer with the RTOS, providing much greater performance than a fully virtualized GPU.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
CIO Framework</h2>
<div class="image">
<img src="Slide24.jpg" alt=""/>
</div>
<p>The CIO server controls access to hardware resources from the Rich OS and RTOS. This diagram intends to show the interaction between clients and the CIO server.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Draw 2D</h2>
<div class="image">
<img src="Slide26.jpg" alt=""/>
</div>
<p>Simple 2D rendering can be done on the Cortex-R7 system using our DRW2D library. The functionality can be used for entire 2D applications, such as an instrument cluster.</p>
<p>We provide an implementation for CPU rendering, as well as with the DaveHD 2D GPU. Example applications are also provided.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Window Manager</h2>
<div class="image">
<img src="Slide28.jpg" alt=""/>
</div>
<p>The Window Manager is our implementation for creating and controlling planes, layers and displays. The 2D graphics applications provide examples of using the Window Manager APIs. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 12 2023 08:05:33 for R-Car CR7 Sample Software by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
